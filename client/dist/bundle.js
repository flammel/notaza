!function(e){function t(t){for(var n,r,s=t[0],o=t[1],l=0,c=[];l<s.length;l++)r=s[l],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&c.push(i[r][0]),i[r]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);for(a&&a(t);c.length;)c.shift()()}var n={},i={0:0};function r(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var s=new Promise((function(t,r){n=i[e]=[t,r]}));t.push(n[2]=s);var o,l=document.createElement("script");l.charset="utf-8",l.timeout=120,r.nc&&l.setAttribute("nonce",r.nc),l.src=function(e){return r.p+""+({}[e]||e)+".bundle.js"}(e);var a=new Error;o=function(t){l.onerror=l.onload=null,clearTimeout(c);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;a.message="Loading chunk "+e+" failed.\n("+r+": "+s+")",a.name="ChunkLoadError",a.type=r,a.request=s,n[1](a)}i[e]=void 0}};var c=setTimeout((function(){o({type:"timeout",target:l})}),12e4);l.onerror=l.onload=o,document.head.appendChild(l)}return Promise.all(t)},r.m=e,r.c=n,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],o=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var a=o;r(r.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0);class i{constructor(e,t,n){this._content="",this.page=e,this._content=t.trim(),this.level=n,this.id=(Date.now()+Math.round(1e9*Math.random())).toString()}set content(e){e!==this._content&&(this._content=e,this.page.onBlockChange())}get content(){return this._content}internalLinks(){const e=[],t=this.content.matchAll(/\[([^\]]*)\]\(\.\/([^\)]+)\)/g);for(const[,n,i]of t)e.push({from:this.page.getUri(),to:i,linkText:n,block:this});return e}parents(){const e=[];let t=this.parent();for(;t;)e.unshift(t),t=t.parent();return e}parent(){let e=this.prev;for(;e&&e.level>=this.level;)e=e.prev;return e}children(){const e=[];let t=this.next;for(;t&&t.level>this.level;)e.push(t),t=t.next;return e}isEmpty(){return this.content.length<1}split(e,t){this.content=e;const n=new i(this.page,t,this.level);return n.prev=this,this.next&&(this.next.prev=n,n.next=this.next),this.next=n,n}mergeWithPrev(){if(this.prev)return this.prev.content=this.prev.content+this.content,this.remove()}mergeWithNext(){if(this.next)return this.content=this.content+this.next.content,this.next.remove()}changeLevel(e){if(this.prev){const t=this.level;this.level=Math.min(10,this.prev.level+1,Math.max(0,this.level+e)),this.level!==t&&this.page.onBlockChange()}return this.level}remove(){return this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.page.onBlockChange(),this}setCheckbox(e){this.content.startsWith("[]")&&!0===e?this.content="[x]"+this.content.substring(2):this.content.startsWith("[x]")&&!1===e&&(this.content="[]"+this.content.substring(3))}}class r{constructor(e,t,n,r,s){var o;this.wiki=e,this.exists=s,this.saving=!1,this.undoStack=[],this.redoStack=[],this.changeListeners=[],this.uri=t,this.title=decodeURI(n),this.firstBlock=null!==(o=this.parseContentToBlocks(r))&&void 0!==o?o:new i(this,"",0),this.undoStack.push(this.toMarkdown())}static fromMarkdown(e,t,n){const[i,s]=r.splitMarkdown(n);return new r(e,t,i,s,!0)}static splitMarkdown(e){var t;const n=e.split("\n");n.shift();const i=(null!==(t=n.shift())&&void 0!==t?t:"").substring("title: ".length).replace(/^"(.*)"$/,"$1");for(n.shift();""===n[0];)n.shift();return[i,n.join("\n")]}getTitle(){return this.title}setTitle(e){e!==this.title&&(this.title=e,this.scheduleChangeListenerCall())}setMarkdown(e){var t;const[n,s]=r.splitMarkdown(e);this.isDate()||(this.title=n),this.firstBlock=null!==(t=this.parseContentToBlocks(s))&&void 0!==t?t:new i(this,"",0),this.scheduleChangeListenerCall()}getUri(){return this.uri}getBacklinks(){return this.wiki.getAllLinksTo(this)}matches(e){let t=this.title.toLowerCase().indexOf(e.toLowerCase())>=0?100:0;const n=[];for(const i of this.blocksInOrder()){const r=i.content;let s=r.toLowerCase().indexOf(e.toLowerCase());for(;s>=0;)t+=1,n.push({before:r.substring(Math.max(0,s-20),s),match:r.substring(s,s+e.length),after:r.substring(s+e.length,s+e.length+20)}),s=r.toLowerCase().indexOf(e.toLowerCase(),s+1)}return{score:t,matches:n}}links(){return this.blocksInOrder().flatMap(e=>e.internalLinks())}blocksInOrder(){const e=[];let t=this.firstBlock;for(;t;)e.push(t),t=t.next;return e}toMarkdown(){const e=["---",'title: "'+this.getTitle().trim()+'"',"...",""];for(const t of this.blocksInOrder()){const n=t.content.split("\n");e.push(" ".repeat(4*t.level)+"* "+n.shift()),e.push(...n.map(e=>" ".repeat(4*t.level+2)+e))}return e.push(""),e.join("\n")}isDate(){return null!==this.title.match(/\d{4}-\d{2}-\d{2}/)}prev(e){if(this.isDate()){const t=new Date(this.title);return t.setDate(t.getDate()-1),e.getPage(t.toISOString().substring(0,10))}}onBlockChange(){this.scheduleChangeListenerCall()}scheduleChangeListenerCall(){this.saving=!0,setTimeout(()=>{this.saving&&(this.saving=!1,this.callChangeListeners())},0)}addChangeListener(e){this.changeListeners.push(e)}removeChangeListener(e){this.changeListeners.splice(this.changeListeners.indexOf(e),1)}callChangeListeners(){for(const e of this.changeListeners)e();this.pushUnique(this.undoStack,this.toMarkdown())}undo(){const e=this.undoStack.pop();if(!e)return;this.pushUnique(this.redoStack,e);const t=this.undoStack.pop();t?this.setMarkdown(t):(this.redoStack.pop(),this.undoStack.push(e))}pushUnique(e,t){e[e.length-1]!==t&&e.push(t)}redo(){const e=this.redoStack.pop();e&&(this.pushUnique(this.undoStack,e),this.setMarkdown(e))}parseContentToBlocks(e){const t=e.split("\n"),n=new RegExp(/^( *)\* (.*)$/);let r,s;const o=[],l=[];for(;""===t[0];)t.shift();const a=()=>{if(l.length<1)return;const e=new i(this,l.join("\n"),Math.max(0,o.length-1));l.splice(0),r||(r=e),s&&(s.next=e,e.prev=s),s=e};for(const e of t){const t=e.match(n);if(t){a();const e=t[1].length;for(;o[o.length-1]>=e;)o.pop();o.push(e)}l.push(e.substr(o[o.length-1]+2))}return a(),r}}class s{constructor(e){this.wiki=e}filterPagesByTitle(e){return this.wiki.getPages().filter(t=>t.getTitle().toLowerCase().indexOf(e.toLowerCase())>=0)}}class o{constructor(){this.pages=new Map,this.linksByFrom=new Map,this.linksByTo=new Map,this.pageList=new s(this),this.onChangeListeners=[]}addPage(e,t){const n=r.fromMarkdown(this,e,t);this.pages.set(e,n),this.storeAllLinksOnPage(n)}callOnChange(){for(const e of this.onChangeListeners)e()}onChange(e){this.onChangeListeners.push(e)}getPage(e){""!==e&&"/"!==e||(e=(new Date).toISOString().substring(0,10));const t=this.pages.get(e);return t||new r(this,e,e,"",!1)}getPages(){return[...this.pages.values()]}getPageList(){return this.pageList}deletePage(e){this.pages.delete(e.getUri()),this.removeAllStoredLinksFromPage(e),this.callOnChange()}getAllLinksTo(e){var t,n;return null!==(n=null===(t=this.linksByTo.get(e.getUri()))||void 0===t?void 0:t.map(e=>{if(!e.linkText){const t=this.pages.get(e.from);return t?{...e,linkText:t.getTitle()}:{...e,linkText:e.from}}return e}))&&void 0!==n?n:[]}storeAllLinksOnPage(e){for(const t of e.links()){const e=this.linksByFrom.get(t.from);e?e.push(t):this.linksByFrom.set(t.from,[t]);const n=this.linksByTo.get(t.to);n?n.push(t):this.linksByTo.set(t.to,[t])}}removeAllStoredLinksFromPage(e){var t;for(const n of null!==(t=this.linksByFrom.get(e.getUri()))&&void 0!==t?t:[]){const e=this.linksByTo.get(n.to);e&&this.linksByTo.set(n.to,e.filter(e=>e!==n))}this.linksByFrom.delete(e.getUri())}update(e){this.pages.has(e.getUri())||(e.exists=!0,this.pages.set(e.getUri(),e),this.removeAllStoredLinksFromPage(e),this.storeAllLinksOnPage(e),this.callOnChange())}}const l={_:["<emph>","</emph>"],"`":["<code>","</code>"],"*":["<strong>","</strong>"],"~":["<strike>","</strike>"]};function a(e,t,n){const i=e.indexOf(t,n);return[e.substring(n,i<0?void 0:i),i<0?e.length:i+t.length]}function c(e,t,n){let i="",r=!0;if("./"===e.substring(0,2)){const s=n.getPage(e.substring(2));s.exists?(i=' class="internal" ',t.trim().length<1&&(t=s.getTitle(),r=!1)):i=' class="internal missing" '}else i=' target="_blank" rel="noopener noreferrer" class="external" ';return t.trim().length<1?t=e:r&&(t=function(e){let t=0;const n=[];let i="";for(;t<e.length;){const r=e[t],s=n[n.length-1],o=n[n.length-2],a=l[r];a?(s&&s.token===r?(o?o.content+=a[0]+s.content+a[1]:i+=a[0]+s.content+a[1],n.pop()):n.push({token:r,content:""}),t++):(s?s.content+=r:i+=r,t++)}if(i.length<1&&e.length>=1)return e;if(n.length>0)return e;return i}(t)),`<a${i}href="${e}">${t}</a>`}class d{constructor(e){this.wiki=e,this.mathRenderFunction=e=>e,n.e(1).then(n.t.bind(null,2,7)).then(e=>{this.mathRenderFunction=e.renderToString;for(const t of document.getElementsByClassName("math"))t.innerHTML=e.renderToString(t.innerHTML)})}render(e){let t=0;const n=[];let i="",r=!1;for(e.startsWith("> ")?(t=2,r=!0):e.startsWith("[] ")?(t=3,i='<input type="checkbox">'):e.startsWith("[x] ")&&(t=3,i='<input type="checkbox" checked>');t<e.length;){const r=e[t-1],s=e[t],o=(e[t+1],n[n.length-1]),d=n[n.length-2];let u;if(e.startsWith("![",t)){const[n,i]=a(e,"](",t+2),[r,s]=a(e,")",i);t=s,u=`<img src="${r}" alt="${n||r}">`}else if(e.startsWith("[",t)){const[n,i]=a(e,"](",t+1),[r,s]=a(e,")",i);t=s,u=c(r,n,this.wiki)}else if(e.startsWith("$$",t)){const[n,i]=a(e,"$$",t+2);t=i,u=`<span class="math">${this.mathRenderFunction(n)}</span>`}else if(e.startsWith("http://",t)||e.startsWith("https://",t)){const[n,i]=a(e," ",t);t=i===e.length?i:i-1,u=c(n,n,this.wiki)}if(u){o?o.content+=u:i+=u;continue}const h=l[s];h?(o&&o.token===s?(d?d.content+=h[0]+o.content+h[1]:i+=h[0]+o.content+h[1],n.pop()):" "===r||void 0===r?n.push({token:s,content:""}):o?o.content+=s:i+=s,t++):(o?o.content+=s:i+=s,t++)}for(const e of n)i+=e.token+e.content;return i.length<1&&e.length>=1?e:(i=i.replace(/\n/g,"<br>"),r?"<blockquote>"+i+"</blockquote>":i)}}class u{constructor(e,t){this.wiki=e,this.changePage=t}goToUri(e){e.startsWith("./")&&(e=e.substring(2));const t=this.wiki.getPage(e);history.pushState({uri:t.getUri()},t.getTitle(),"/"===e?"/":t.getUri()),this.changePage(t)}}class h{constructor(e){this.api=e,this.allowedMimeTypes=["image/png","image/jpeg","application/pdf"]}upload(e,t){var n;for(const i of null!==(n=e.items)&&void 0!==n?n:[])if("file"===i.kind&&this.allowedMimeTypes.includes(i.type)){const e=i.getAsFile();e&&this.api.uploadFile(e).then(e=>t(e.filename))}}}function p(e){return function(e){const t=e;return{addClass(...e){for(const n of e)"string"==typeof n&&""!==n&&t.classList.add(n);return this},setAttribute(e,n){return t.setAttribute(e,n.toString()),this},appendChild(e){return t.appendChild(e),this},withChildren(e){for(const n of e)n&&t.appendChild(n);return this},innerHTML(e){return t.innerHTML=e,this},innerText(e){return t.innerText=e,this},addEventListener(e,n){return t.addEventListener(e,e=>n(e,t)),this},apply(e){return e(t),this},data(e,n){return t.dataset[e]=n,this},build:()=>t}}(document.createElement(e))}function g(e){const t=document.createDocumentFragment();for(const n of e)t.appendChild(n);return t}function f(e,t){e.innerHTML="",e.appendChild(t)}function v(e,t){return p("a").setAttribute("href",t).addEventListener("click",n=>{n.preventDefault(),e.goToUri(t)})}var m,k,b={chevronLeft:'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">\n    <path stroke="none" d="M0 0h24v24H0z"/>\n    <polyline points="15 6 9 12 15 18" />\n    </svg>',chevronRight:'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">\n    <path stroke="none" d="M0 0h24v24H0z"/>\n    <polyline points="9 6 15 12 9 18" />\n    </svg>',dotsVertical:'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">\n    <path stroke="none" d="M0 0h24v24H0z"/>\n    <circle cx="12" cy="12" r="1" />\n    <circle cx="12" cy="19" r="1" />\n    <circle cx="12" cy="5" r="1" />\n  </svg>',home:'\n  <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">\n      <path stroke="none" d="M0 0h24v24H0z"/>\n      <polyline points="5 12 3 12 12 3 21 12 19 12" />\n      <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />\n      <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />\n  </svg>\n  '};function w(e,t){return e[1].score===t[1].score?e[0].isDate()&&t[0].isDate()?t[0].getTitle().localeCompare(e[0].getTitle()):e[0].isDate()||t[0].isDate()?t[0].isDate()?e[0].isDate()?0:1:-1:e[0].getTitle().localeCompare(t[0].getTitle()):t[1].score-e[1].score}function L(e,t){var n;const i=document.createElement("ul");let r,s=null!==(n=localStorage.getItem("lastSearch"))&&void 0!==n?n:"",o=[];const l=function(e,t,n,i){const r=document.createElement("input");return r.value=i,r.setAttribute("type","search"),r.setAttribute("placeholder","Search"),r.addEventListener("input",()=>{e(r.value)}),r.addEventListener("keydown",i=>{"Escape"===i.key?(r.value="",e("")):t(e=>{const t=null==e?void 0:e.firstElementChild;if("Enter"===i.key&&t instanceof HTMLAnchorElement)i.preventDefault(),t.click();else if("ArrowDown"===i.key){i.preventDefault();const t=e.nextElementSibling;t instanceof HTMLLIElement&&n(t)}else if("ArrowUp"===i.key){i.preventDefault();const t=e.previousElementSibling;t instanceof HTMLLIElement&&n(t)}})}),r}(c,e=>r?e(r):{},a,s);function a(e){r&&r.classList.remove("active"),r=e,r.classList.add("active")}function c(t){if(s=t,1===s.length)return;localStorage.setItem("lastSearch",s);const n=o.map(e=>[e,""===s?{matches:[],score:1}:e.matches(s)]).filter(([,{score:e}])=>e>0).sort(w).map(t=>function(e,[t,n]){return p("li").appendChild(v(e,t.getUri()).withChildren([p("span").innerText(t.getTitle()).build(),...n.matches.map(e=>p("span").withChildren([document.createTextNode(e.before),p("b").innerText(e.match).build(),document.createTextNode(e.after)]).build())]).build()).build()}(e,t));if(n.length>0)f(i,g(n)),a(n[0]);else{const t=function(e,t){return p("li").addClass("create").appendChild(v(e,t).innerText('Create page "'+t+'"').build()).build()}(e,s);f(i,t),a(t)}}function d(e){o=e;for(const e of o)e.addChangeListener(()=>{c(s)});c(s)}return window.addEventListener("keyup",e=>{if("f"===e.key&&document.activeElement===document.body)return l.focus(),void l.select()}),t&&d(t),{el:p("div").addClass("sidebar").withChildren([p("form").withChildren([v(e,"/").innerHTML(b.home).build(),l]).build(),i]).build(),update:d}}function y(e){return e.getFullYear()+"-"+("0"+(e.getMonth()+1)).substr(-2)+"-"+("0"+e.getDate()).substr(-2)}function C(e,t){return t.isDate()?p("h1").appendChild(v(e,t.getUri()).innerText(t.getTitle()).build()).build():p("h1").appendChild(p("input").apply(e=>e.value=t.getTitle()).addEventListener("keydown",(e,t)=>{("s"===e.key&&e.ctrlKey||"Enter"===e.key)&&(e.preventDefault(),t.blur())}).addEventListener("change",(e,n)=>t.setTitle(n.value)).addEventListener("input",(e,n)=>t.setTitle(n.value)).build()).build()}function T(e,t){if(t.isDate()){const n=new Date(t.getTitle());n.setDate(n.getDate()-1);const i=new Date(t.getTitle());return i.setDate(i.getDate()+1),p("div").addClass("date-nav").withChildren([v(e,y(n)).innerHTML(b.chevronLeft).addClass("date-link").build(),v(e,y(i)).innerHTML(b.chevronRight).addClass("date-link").build()]).build()}}function E(e,t){let n=!1;const i=p("div").addClass("page__actions").build(),r=p("button").innerHTML(b.dotsVertical).addEventListener("click",()=>{n?(n=!1,i.classList.remove("page__actions--open")):(n=!0,i.classList.add("page__actions--open"))}).build(),s=p("div").addClass("page__action-list").withChildren([p("button").innerText("delete").addEventListener("click",()=>{e.deletePage(t)}).build(),p("button").innerText("edit raw").addEventListener("click",()=>{i.classList.remove("page__actions--open"),e.setMode(t,"raw")}).build()]).build();return i.appendChild(r),i.appendChild(s),i}function x(e,t){return p("div").addClass("page__header").withChildren([C(e.navigation,t),T(e.navigation,t),E(e,t)]).build()}function M({markdown:e,registerBlockElement:t,onBlockClick:n},i){return p("div").addClass("block",!!i.isEmpty()&&"block--empty").data("level",i.level.toString()).innerHTML(e.render(i.content)).apply(e=>t(i,e)).addEventListener("click",e=>n(i,e)).build()}function S(e,t){return g([x(e,t),p("div").addClass("blocks").withChildren(t.blocksInOrder().map(t=>M(e,t))).build(),p("h2").innerText("Backlinks").build(),p("div").addClass("blocks","backlinks").withChildren(t.getBacklinks().flatMap(t=>function({markdown:e,navigation:t},n){var i,r;const s=p("div").addClass("block").data("level","0").appendChild(v(t,n.from).innerText(n.linkText).build()).build(),o=n.block.parents(),l=n.block.children();return 0===l.length?o.push(...null!==(r=null===(i=n.block.parent())||void 0===i?void 0:i.children())&&void 0!==r?r:[]):(o.push(n.block),o.push(...l)),g([s,...o.map(t=>p("div").addClass("block").data("level",(t.level+1).toString()).innerHTML(e.render(t.content)).build())])}(e,t))).build()])}function D(e,t){const n=p("div").addClass("page").build();let i;const r={...e,setMode:(e,t)=>s({page:e,mode:t})};function s(e){i=e,document.title=e.page.getTitle(),"raw"===e.mode?(f(n,function(e,t){const n=p("textarea").addClass("raw-editor").innerHTML(t.toMarkdown()).addEventListener("keydown",(n,i)=>{"s"===n.key&&n.ctrlKey&&(n.preventDefault(),t.setMarkdown(i.value),e.setMode(t,"block"))}).build();return g([n,p("div").addClass("buttons").withChildren([p("button").innerText("save").addEventListener("click",()=>{t.setMarkdown(n.value),e.setMode(t,"block")}).build(),p("button").innerText("close").addEventListener("click",()=>{e.setMode(t,"block")}).build()]).build()])}({setMode:(e,t)=>s({page:e,mode:t})},e.page)),n.classList.add("page--raw")):(f(n,S(r,e.page)),n.classList.remove("page--raw")),window.scrollTo(0,0)}return t&&s(t),{rootElement:n,update:s}}function P({markdown:e,upload:t,blockElementMap:n,renderBlock:i,pageList:r}){const s=p("textarea").addClass("inline-editor").setAttribute("placeholder","No content").setAttribute("rows","1").build(),o=p("textarea").addClass("inline-editor","inline-editor--mirror").setAttribute("placeholder","No content").setAttribute("rows","1").build();let l;function a(){s.style.height="auto",s.style.height=s.scrollHeight+"px"}function c(){if(l){const[t,n]=l;l=void 0;const i=s.value;t.content=i,n.classList.remove("block--editing"),t.isEmpty()?n.classList.add("block--empty"):n.classList.remove("block--empty"),n.innerHTML=e.render(t.content)}}function d(e,t){const i=n.get(e);i&&(c(),l=[e,i],i.classList.add("block--editing"),s.value=e.content,f(i,s),s.setSelectionRange(t,t),s.focus(),a())}function u(){return 0===s.selectionStart&&0===s.selectionEnd?"start":s.selectionStart===s.value.length&&s.selectionEnd===s.value.length?"end":"between"}function h(e,t){"ArrowUp"===t.key&&e.prev&&function(){o.style.width=s.clientWidth+"px",o.innerHTML="a";const e=o.scrollHeight;return o.innerHTML=s.value.substring(0,s.selectionStart),o.scrollHeight===e}()?(t.preventDefault(),d(e.prev,-1)):"ArrowDown"===t.key&&e.next&&function(){o.style.width=s.clientWidth+"px",o.innerHTML=s.value;const e=o.scrollHeight;return o.innerHTML=s.value.substring(0,s.selectionEnd),o.scrollHeight===e}()?(t.preventDefault(),d(e.next,-1)):"ArrowLeft"===t.key&&"start"===u()&&e.prev?(t.preventDefault(),d(e.prev,-1)):"ArrowRight"===t.key&&"end"===u()&&e.next&&(t.preventDefault(),d(e.next,0))}return s.addEventListener("keydown",e=>{if(!l)return;const[t,r]=l;"Enter"!==e.key||e.shiftKey?"Escape"===e.key||"s"===e.key&&e.ctrlKey?(e.preventDefault(),c()):"Backspace"===e.key?function(e,t){var i;if("start"!==u()&&s.value.length>0||!e.prev)return;t.preventDefault(),c();const r=e.prev,o=r.content.length,l=e.mergeWithPrev();l&&(null===(i=n.get(l))||void 0===i||i.remove()),n.get(r)&&d(r,o)}(t,e):"Delete"===e.key?function(e,t){var i;if("end"!==u()&&s.value.length>0||!e.next)return;t.preventDefault(),c();const r=e.content.length,o=e.mergeWithNext();o&&(null===(i=n.get(o))||void 0===i||i.remove()),d(e,r)}(t,e):"Tab"===e.key?function(e,t,n){if(!e.prev)return;n.preventDefault();const i=e.changeLevel(n.shiftKey?-1:1);t.dataset.level=i.toString()}(t,r,e):["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&h(t,e):(e.preventDefault(),function(e,t){if(t.shiftKey||t.ctrlKey)return;t.preventDefault();const r=s.value.substring(0,s.selectionStart),o=s.value.substring(s.selectionEnd);s.value=r,c();const l=e.split(r,o),a=i(l);n.set(l,a);const u=n.get(e);u&&u.insertAdjacentElement("afterend",a),d(l,0)}(l[0],e))}),s.addEventListener("input",()=>{a()}),s.addEventListener("keyup",e=>{var t;if("]"===e.key&&"["===s.value.substring(s.selectionStart-2,s.selectionStart-1)){const e=function(e,t,n){let i,r="";const s=p("div").addClass("autocomplete").build(),o=p("ul").addClass("autocomplete__list").build(),l=p("input").addClass("autocomplete__input").addEventListener("keyup",a=>{var c,d;if("Enter"===a.key)return t((null==i?void 0:i.dataset.uri)||""),null===(c=s.parentElement)||void 0===c||c.removeChild(s),void n();if("Escape"===a.key)return null===(d=s.parentElement)||void 0===d||d.removeChild(s),void n();if(r!==l.value){const t=[];for(const n of e.filterPagesByTitle(l.value).slice(0,20))t.push(`<li data-uri="${n.getUri()}" class="autocomplete__item">${n.getTitle()}</li>`);o.innerHTML=t.join(""),o.firstElementChild instanceof HTMLLIElement&&(i=o.firstElementChild,i.classList.add("autocomplete__item--selected"))}}).addEventListener("keydown",e=>(r=l.value,"ArrowDown"===e.key&&(null==i?void 0:i.nextElementSibling)instanceof HTMLLIElement?(e.preventDefault(),i.classList.remove("autocomplete__item--selected"),i=i.nextElementSibling,void i.classList.add("autocomplete__item--selected")):"ArrowUp"===e.key&&(null==i?void 0:i.previousElementSibling)instanceof HTMLLIElement?(e.preventDefault(),i.classList.remove("autocomplete__item--selected"),i=i.previousElementSibling,void i.classList.add("autocomplete__item--selected")):void 0)).build();return s.appendChild(l),s.appendChild(o),{element:s,focus:()=>l.focus()}}(r,e=>{s.value=s.value+" [](./"+e+")"},()=>s.focus());null===(t=s.parentElement)||void 0===t||t.appendChild(e.element),e.focus()}}),s.addEventListener("paste",e=>{e.clipboardData&&t.upload(e.clipboardData,e=>{s.value=s.value+"![](./"+e+")"})}),document.addEventListener("drop",e=>{"drop"===e.type&&e.target===s&&e.dataTransfer&&(e.preventDefault(),t.upload(e.dataTransfer,e=>{s.value=s.value+"![](./"+e+")"}))}),document.addEventListener("click",e=>{e.target instanceof HTMLElement&&!e.target.closest(".page")&&c()}),{editor:s,mirror:o,isEditing:e=>!!l&&l[0]===e,startEditing:d,stopEditing:c}}null===(m=document.getElementById("app"))||void 0===m||m.appendChild(function(e){const t=new o,n=new d(t),i=new h(e),r=function(){const e=p("div").addClass("notifications").build();return{el:e,add(t,n){const i=p("div").addClass("notification","success"===n?"notification--success":"notification--error").innerText(t).build();e.appendChild(i),setTimeout(()=>e.removeChild(i),3e3)}}}(),s=new u(t,T),l=new Map,a=P({upload:i,markdown:n,pageList:t.getPageList(),blockElementMap:l,renderBlock:e=>M({markdown:n,registerBlockElement:b,onBlockClick:w},e)}),c={markdown:n,navigation:s,deletePage:function(n){if(!window.confirm('Do you really want to delete page "'+n.getTitle()+'"?'))return;t.deletePage(n),e.deletePage(n).then(e=>{e.success?r.add("Success","success"):r.add("Error 1","error")}).catch(e=>{console.error(e),r.add("Error 2","error")}),s.goToUri("/")},registerBlockElement:b,onBlockClick:w},v=D(c),m=function(e){const t=p("div").addClass("more-pages").build();return{rootElement:t,update(n){f(t,g(n.map(t=>D(e,{page:t,mode:"block"}).rootElement)))}}}(c),k=L(s,[]);function b(e,t){l.set(e,t)}function w(e,t){if(t.target instanceof HTMLAnchorElement||a.isEditing(e))return;if(t.target instanceof HTMLInputElement&&"checkbox"===t.target.type)return void e.setCheckbox(t.target.checked);t.preventDefault(),t.stopPropagation();const n=function(e,t){if(document.caretPositionFromPoint){const n=document.caretPositionFromPoint(e,t);if(n)return[n.offsetNode,n.offset]}else if(document.caretRangeFromPoint){const n=document.caretRangeFromPoint(e,t);return[n.startContainer,n.startOffset]}}(t.clientX,t.clientY);let i=-1;n&&(i=function(e,t,n){const i=e.textContent;if(!i||0===i.length)return 0;if(null===e.nextSibling&&t===i.length)return n.length;const r=[];let s=n.indexOf(i,0);for(;s>=0;)r.push(s),s=n.indexOf(i,s+i.length);if(1===r.length)return r[0]+t;{const i=[];let s=e.previousSibling;for(;s;)s instanceof HTMLAnchorElement&&i.push(s.getAttribute("href")||""),i.push(s.textContent||""),s=s.previousSibling;let o=0;for(const e of i)o=n.indexOf(e,o)+e.length;for(const e of r)if(e>=o)return e+t;return n.length}}(n[0],n[1],e.content)),a.startEditing(e,i)}const y=new Set;let C;function T(n){if(C=n,v.update({page:n,mode:"block"}),y.has(n)||(y.add(n),n.addChangeListener(()=>function(n){e.savePage(n).then(e=>{e.success?(t.update(n),r.add("Success","success")):r.add("Error 1","error")}).catch(e=>{console.error(e),r.add("Error 2","error")})}(n))),""===window.location.pathname.substring(1)){const e=[],i=7;let r=n.prev(t);for(;r&&e.length<=i;)e.push(r),r=r.prev(t);m.update(e)}else m.update([])}return window.onpopstate=e=>{T(t.getPage(e.state.uri))},document.addEventListener("keydown",e=>{C&&("z"===e.key&&e.ctrlKey&&(e.preventDefault(),C.undo(),v.update({page:C,mode:"block"})),"Z"===e.key&&e.ctrlKey&&(e.preventDefault(),C.redo(),v.update({page:C,mode:"block"})))}),document.addEventListener("click",e=>{if(e.target instanceof HTMLAnchorElement&&e.target.classList.contains("internal")&&!e.ctrlKey){const t=e.target.getAttribute("href");t&&(e.preventDefault(),s.goToUri(t))}}),e.loadPages().then(e=>{for(const n of e)t.addPage(n.uri,n.markdown);const n=window.location.pathname.substring(1);T(t.getPage(n)),k.update(t.getPages())}),t.onChange(()=>k.update(t.getPages())),g([k.el,p("main").withChildren([v.rootElement,m.rootElement]).build(),r.el,a.mirror])}(new class{constructor(e){this.uri=e}loadPages(){return fetch(this.uri+"/pages").then(e=>e.json()).then(e=>e.data)}savePage(e){return fetch(this.uri+"/pages/"+e.getUri(),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({uri:e.getUri(),markdown:e.toMarkdown()})}).then(e=>e.json()).then(e=>e)}deletePage(e){return fetch(this.uri+"/pages/"+e.getUri(),{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>e)}uploadFile(e){const t=new FormData;return t.append("file",e),fetch(this.uri+"/files",{method:"POST",body:t}).then(e=>e.json()).then(e=>e.data)}}(null!==(k=window.localStorage.getItem("apiUri"))&&void 0!==k?k:""))),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/serviceWorker.js").then()})}]);
//# sourceMappingURL=bundle.js.map